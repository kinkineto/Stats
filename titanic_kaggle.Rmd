---
title: "Titanic kaggle"
author: "Joaquim Neto"
date: "08/05/2021"
output: html_document
---

# Importação dos dados

```{r}
library(readr)

titanic.test <- read_csv("C:/Users/Rosiane/Desktop/Neto/R anotações/Coisinhas/test.csv")

titanic.train <- read_csv("C:/Users/Rosiane/Desktop/Neto/R anotações/Coisinhas/train.csv")

```

## Visualização do banco de dados

```{r}
head(titanic.train)
tail(titanic.train)
summary(titanic.train)
str(titanic.train)

head(titanic.test)
tail(titanic.test)
summary(titanic.test)
str(titanic.test)
```

# Limpando os dados

## Primeiro vamos juntar os datasets

```{r}
titanic.train$IsTrainSet <- TRUE   #coluna para sabermos que é de treino
titanic.test$IsTrainSet <- FALSE
```

Vamos ver se ambos possuem as mesmas colunas

```{r}
names(titanic.test) #nao tem a coluna "Survived"
names(titanic.train)
```

Vamos adicionar a coluna survied aos dados teste

```{r}
titanic.test$Survived <- NA
```

Agora que a formatação de ambos é a mesma, podemos juntá-los

```{r}
titanic.full <- rbind(titanic.train, titanic.test)

head(titanic.full)
table(titanic.full$IsTrainSet)
```

## Agora vamos dar uma olhada nos valores faltantes

```{r}
table(titanic.full$Pclass)
1309 - (323+277+709)

table(titanic.full$Embarked)
1309 - (270+123+914) #dois valores faltantes
library(tidyr)
titanic.full$Embarked = replace_na(titanic.full$Embarked, "S") #Método q achei

table(is.na(titanic.full$Age)) #263 NA em idade
titanic.full$Age = replace_na(titanic.full$Age, median(titanic.full$Age, na.rm = T)) #Vlw tidyR

table(is.na(titanic.full$Fare)) #1 valor faltante
titanic.full$Fare = replace_na(titanic.full$Fare, median(titanic.full$Fare, na.rm = T)) #substituido pela mediana
```

Vamos mudar algumas coisas pra factor pra facilitar nossa vida

```{r}
str(titanic.full)
titanic.full$Pclass <- as.factor(titanic.full$Pclass)
titanic.full$Sex <- as.factor(titanic.full$Sex)
titanic.full$Embarked <- as.factor(titanic.full$Embarked)
```

# Vamos separar os dados novamente

```{r}
titanic.train = titanic.full[titanic.full$IsTrainSet == "TRUE", ]
titanic.test = titanic.full[titanic.full$IsTrainSet == "FALSE", ]
```

Vamos colocar a coluna "Survived" como factor nos dados de treino

```{r}
titanic.train$Survived <- as.factor(titanic.train$Survived)
```

# Agora vamos fazer o modelo Random Forest

```{r message=FALSE, warnings=FALSE}
library("randomForest")
```

```{r}
survived.equation <- "Survived ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked"

survived.formula <- as.formula(survived.equation)


titanic.model = randomForest(formula = survived.formula,
                             data = titanic.train,
                             ntree = 500,
                             mtry = 3,
                             nodesize = 0.01*nrow(titanic.train))

Sobreviveu = predict(titanic.model, newdata = titanic.test)
```

# Fazendo a pasta com os dados gerados

```{r}
PassengerId <- titanic.test$PassengerId
output.df <- as.data.frame(PassengerId)

output.df$Survived <- Sobreviveu

write.csv(output.df,"titanic_kaggle_submission.csv",row.names = FALSE)
```




























